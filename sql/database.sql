CREATE TABLE IF NOT EXISTS `USUARIO` (
    `ID` varchar(50) NOT NULL UNIQUE,
    `NMUSUARIO` varchar(50) NOT NULL,
    `CARGO` varchar(30) NOT NULL,
    `DTINCLUSAO` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `DTULTATU` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `IDUSERINCLUSAO` varchar(50),
    `EMAIL` varchar(50) NOT NULL UNIQUE,
    `PASSWORD` varchar(100) NOT NULL,
    PRIMARY KEY (`ID`)
);

CREATE TABLE IF NOT EXISTS `ESCOLA` (
	`ID` int AUTO_INCREMENT NOT NULL UNIQUE,
	`NMESCOLA` varchar(30) NOT NULL,
	`DTINCLUSAO` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`DTULTATU` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	`IDUSERINCLUSAO` varchar(50) NOT NULL,
	PRIMARY KEY (`ID`)
);

ALTER TABLE ESCOLA
ADD CONSTRAINT FK_IDUSERINCLUSAO FOREIGN KEY (IDUSERINCLUSAO) REFERENCES USUARIO(ID);
CREATE TABLE IF NOT EXISTS `TURMA` (
	`ID` int AUTO_INCREMENT NOT NULL UNIQUE,
	`NMTURMA` varchar(50) NOT NULL,
	`DTINCLUSAO` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`DTULTATU` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	`IDUSERINCLUSAO` varchar(50) NOT NULL,
	`IDESCOLA` int NOT NULL,
	PRIMARY KEY (`ID`)
);

ALTER TABLE TURMA
ADD CONSTRAINT FK_IDUSERINCLUSAO FOREIGN KEY (IDUSERINCLUSAO) REFERENCES USUARIO(ID);

CREATE TABLE IF NOT EXISTS `USUARIOINSTITUICAO` (
	`ID` int AUTO_INCREMENT NOT NULL UNIQUE,
	`IDTURMA` int,
	`IDESCOLA` int NOT NULL,
	`IDUSUARIO` varchar(50) NOT NULL,
	`DTINCLUSAO` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`DTULTATU` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY (`ID`)
);

ALTER TABLE USUARIOINSTITUICAO
ADD CONSTRAINT FK_IDUSUARIO FOREIGN KEY (IDUSUARIO) REFERENCES USUARIO(ID);

CREATE TABLE IF NOT EXISTS `REQUISICAOMATERIAL` (
	`ID` int AUTO_INCREMENT NOT NULL UNIQUE,
	`IDREQUISICAO` varchar(50) NOT NULL,
	`IDMATERIAL` int NOT NULL,
	`IDESCOLA` int NOT NULL,
	`IDUSERINCLUSAO` varchar(50) NOT NULL,
	`STATUS` varchar(20) NOT NULL,
	`QTMATERIAL` int DEFAULT 1,
	`DSJUSTIFICATIVA` varchar(200) NOT NULL,
	`DSRETORNO` varchar(500),
	`DTUTILIZACAO` timestamp,
	`DTINCLUSAO` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`DTULTATU` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY (`ID`)
);

/

ALTER TABLE REQUISICAOMATERIAL
ADD CONSTRAINT FK_REQ_MATERIAL_IDUSERINCLUSAO FOREIGN KEY (IDUSERINCLUSAO) REFERENCES USUARIO(ID);

CREATE TABLE IF NOT EXISTS `MATERIAL` (
	`ID` int AUTO_INCREMENT NOT NULL UNIQUE,
	`NMMATERIAL` varchar(20) NOT NULL,
	`DSMATERIAL` varchar(50),
	`IDUSERINCLUSAO` varchar(50) NOT NULL,
	`DTINCLUSAO` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`DTULTATU` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY (`ID`)
);

ALTER TABLE MATERIAL
ADD CONSTRAINT FK_MATERIAL_IDUSERINCLUSAO FOREIGN KEY (IDUSERINCLUSAO) REFERENCES USUARIO(ID);

CREATE TABLE IF NOT EXISTS `FAIXAETARIABNCC` (
	`ID` int AUTO_INCREMENT NOT NULL UNIQUE,
	`DSFAIXAETARIA` varchar(100) NOT NULL,
	`DTINCLUSAO` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`DTULTATU` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY (`ID`)
)

CREATE TABLE IF NOT EXISTS `CAMPOEXPBNCC` (
	`ID` int AUTO_INCREMENT NOT NULL UNIQUE,
	`NMCAMPOEXP` varchar(100) NOT NULL,
	`DTINCLUSAO` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`DTULTATU` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY (`ID`)
)

CREATE TABLE IF NOT EXISTS `BNCC` (
	`ID` int AUTO_INCREMENT NOT NULL UNIQUE,
	`CODBNCC` varchar(30) NOT NULL,
	`IDFAIXAETARIABNCC` int NOT NULL,
	`IDCAMPOEXPBNCC` int NOT NULL,
	`DSOBJETIVO` varchar(500) NOT NULL,
	`DTINCLUSAO` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`DTULTATU` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY (`ID`)
);

CREATE TABLE IF NOT EXISTS `TURNO` (
	`ID` int AUTO_INCREMENT NOT NULL UNIQUE,
	`NMTURNO` varchar(50) NOT NULL,
	`DTINCLUSAO` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`DTULTATU` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY (`ID`)
)

CREATE TABLE IF NOT EXISTS `PLANEJAMENTO` (
	`ID` int AUTO_INCREMENT NOT NULL UNIQUE,
	`STATUS` varchar(30) NOT NULL,
	`DTPLANO` timestamp NOT NULL,
	`IDESCOLA` int NOT NULL,
	`IDTURMA` int NOT NULL,
	`IDTURNO` int NOT NULL,
	`DSATIVIDADE` varchar(500) NOT NULL,
	`DSRETORNO` varchar(500),
	`IDBNCC` varchar(500),
	`NRREVISOES` int DEFAULT 0,
	`IDUSERINCLUSAO` varchar(50) NOT NULL,
	`DTINCLUSAO` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`DTULTATU` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	PRIMARY KEY (`ID`)
);

ALTER TABLE PLANEJAMENTO
ADD CONSTRAINT FK_IDUSERINCLUSAO FOREIGN KEY (IDUSERINCLUSAO) REFERENCES USUARIO(ID);

CREATE TABLE IF NOT EXISTS `REGISTROALIMENTAR` (
	`ID` int AUTO_INCREMENT NOT NULL UNIQUE,
	`DTREFEICAO` timestamp NOT NULL,
	`IDTIPOREFEICAO` int NOT NULL,
	`IDFAIXAETARIA` int NOT NULL,
	`REPETICAO` int NOT NULL,
	`SOBRALIMPA` float NOT NULL,
	`SOBRASUJA` float NOT NULL,
	`RESTOINGESTA` float NOT NULL,
	`IDESCOLA` int NOT NULL,
	`DTINCLUSAO` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	`DTULTATU` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	`IDUSERINCLUSAO` varchar(50) NOT NULL,
	PRIMARY KEY (`ID`)
);

ALTER TABLE REGISTROALIMENTAR
ADD CONSTRAINT FK_REGALIM_IDUSERINCLUSAO FOREIGN KEY (IDUSERINCLUSAO) REFERENCES USUARIO(ID);
/
SELECT * FROM PLANEJAMENTO
/

SELECT
	PL.DTPLANO,
	PL.STATUS,
	PL.DSATIVIDADE,
	PL.DSRETORNO,
	PL.NRREVISOES,
	E.ID AS IDESCOLA,
	E.NMESCOLA,
	T.ID AS IDTURMA,
	T.NMTURMA -- ,
--	BNCC.CODBNCC,
--	BNCC.NMCAMPOEXP
FROM
	PLANEJAMENTO PL
	INNER JOIN ESCOLA E
		ON PL.IDESCOLA = E.ID
	INNER JOIN TURMA T
		ON PL.IDTURMA = T.ID
--	INNER JOIN BNCC
--		ON INSTR(PL.IDBNCC, CONCAT('|', PL.IDBNCC, '|')) <> 0
WHERE
	PL.IDESCOLA = 1
	AND PL.IDTURMA = 4
	AND (PL.DTPLANO BETWEEN '2024-06-17' AND '2024-06-21')
	/
	SELECT * FROM MATERIAL
/
SELECT * FROM REQUISICAOMATERIAL